# Rhetoric Lens - æ•°æ®æ”¶é›†ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
Twitter/X é¡µé¢
    â†“
Chrome æ’ä»¶ (åˆ†ææ¨æ–‡)
    â†“
æœ¬åœ° Ollama API (AI æ¨¡å‹åˆ†æ)
    â†“
Python æ•°æ®æœåŠ¡å™¨ (ä¿å­˜è®­ç»ƒæ•°æ®)
    â†“
twitter_training_data.jsonl (JSONL æ ¼å¼æ•°æ®é›†)
```

## âš ï¸ æ•…éšœæ’æŸ¥ï¼šä¸ºä»€ä¹ˆæ²¡æœ‰ä¿å­˜æ•°æ®ï¼Ÿ

### é—®é¢˜è¯Šæ–­æ¸…å•

å¦‚æœåç«¯æœåŠ¡å·²å¯åŠ¨ä½†æ²¡æœ‰ä¿å­˜æ•°æ®ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥ï¼š

#### âœ… 1. ç¡®è®¤åç«¯æœåŠ¡æ­£å¸¸
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://127.0.0.1:8881/health
# åº”è¿”å›: {"status":"ok","service":"rhetoric-lens-data-collector"}

# æŸ¥çœ‹å½“å‰ç»Ÿè®¡
curl http://127.0.0.1:8881/stats
# åº”è¿”å›: {"total_records": N, "file_size": XXX, ...}

# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_save.py
```

#### âœ… 2. é‡æ–°åŠ è½½ Chrome æ‰©å±• â­ï¸ **æœ€å¸¸è§åŸå› **
ä¿®æ”¹ `content.js` å**å¿…é¡»**é‡æ–°åŠ è½½æ‰©å±•ï¼š
1. æ‰“å¼€ `chrome://extensions/`
2. æ‰¾åˆ° "Rhetoric Lens" æ‰©å±•
3. ç‚¹å‡» ğŸ”„ **é‡æ–°åŠ è½½**æŒ‰é’®
4. åˆ·æ–° Twitter é¡µé¢

#### âœ… 3. ç†è§£æ•°æ®ä¿å­˜é€»è¾‘
**åªæœ‰æ–°çš„æˆåŠŸåˆ†ææ‰ä¼šè¢«ä¿å­˜ï¼š**
```javascript
// content.js ä¸­çš„é€»è¾‘
if (!result.error && !wasCached) {
  await saveAnalysisRecord(text, result, false);
}
```

è¿™æ„å‘³ç€ï¼š
- âŒ åˆ†æé”™è¯¯ â†’ ä¸ä¿å­˜
- âŒ **ç¼“å­˜å‘½ä¸­** â†’ ä¸ä¿å­˜ï¼ˆå·²ç»åˆ†æè¿‡çš„æ¨æ–‡ï¼‰
- âœ… æ–°çš„æˆåŠŸåˆ†æ â†’ ä¿å­˜

#### âœ… 4. æ¸…é™¤ç¼“å­˜è¿›è¡Œæµ‹è¯•
è¦æµ‹è¯•æ•°æ®ä¿å­˜åŠŸèƒ½ï¼Œéœ€è¦åˆ†æ**æ–°çš„**æ¨æ–‡ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. Application â†’ Storage â†’ Chrome Storage â†’ Local Storage
3. æ‰¾åˆ°å¹¶æ¸…é™¤ `rhetoricCache`
4. æˆ–è€…è®¿é—®ä¹‹å‰æ²¡åˆ†æè¿‡çš„æ–°æ¨æ–‡

#### âœ… 5. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Console æ ‡ç­¾ï¼ŒæŸ¥æ‰¾ï¼š
- âœ… æˆåŠŸï¼š`[Rhetoric Lens] ğŸ“ å·²ä¿å­˜è‡³æ•°æ®é›† (æ€»è®¡: X æ¡)`
- âŒ å¤±è´¥ï¼š`[Rhetoric Lens] âš ï¸ æ— æ³•è¿æ¥åˆ°æ•°æ®æ”¶é›†æœåŠ¡ (ç«¯å£ 8881)`
- â„¹ï¸ ç¼“å­˜ï¼š`[Rhetoric Lens] å‘½ä¸­ç¼“å­˜: ...`

### å¿«é€Ÿæµ‹è¯•æµç¨‹

```bash
# 1. å¯åŠ¨åç«¯
python save_server.py

# 2. æ–°ç»ˆç«¯ï¼šæµ‹è¯•åç«¯
python test_save.py
# åº”è¯¥çœ‹åˆ°: çŠ¶æ€ç : 200, total_records: 1

# 3. æ£€æŸ¥æ•°æ®æ–‡ä»¶
Get-Content twitter_training_data.jsonl
# åº”è¯¥èƒ½çœ‹åˆ°ä¿å­˜çš„JSONæ•°æ®

# 4. é‡æ–°åŠ è½½æ‰©å±•å¹¶è®¿é—®Twitter
# - åˆ° chrome://extensions/ é‡æ–°åŠ è½½
# - è®¿é—® x.com å¹¶æ»šåŠ¨æŸ¥çœ‹æ¨æ–‡
# - æŒ‰F12æŸ¥çœ‹Consoleæ—¥å¿—
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å®‰è£… Python ä¾èµ–

```bash
pip install fastapi uvicorn
```

### 2ï¸âƒ£ å¯åŠ¨æ•°æ®æ”¶é›†æœåŠ¡å™¨

åœ¨æ’ä»¶ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
python save_server.py
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
============================================================
ğŸš€ Rhetoric Lens æ•°æ®æ”¶é›†æœåŠ¡å·²å¯åŠ¨
ğŸ“ æ•°æ®å°†ä¿å­˜è‡³: D:\code\rhetoric-detector-extension\twitter_training_data.jsonl
ğŸŒ æœåŠ¡åœ°å€: http://127.0.0.1:8888
ğŸ“Š ç»Ÿè®¡æ¥å£: http://127.0.0.1:8888/stats
============================================================
INFO:     Started server process [12345]
INFO:     Uvicorn running on http://127.0.0.1:8888
```

### 3ï¸âƒ£ å¯åŠ¨ Ollama

ç¡®ä¿ Ollama æ­£åœ¨è¿è¡Œï¼ˆç«¯å£ 11434ï¼‰ï¼š

```bash
ollama serve
```

### 4ï¸âƒ£ åŠ è½½æ’ä»¶

1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. å¼€å¯å³ä¸Šè§’ã€Œå¼€å‘è€…æ¨¡å¼ã€
4. ç‚¹å‡»ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€
5. é€‰æ‹©æ’ä»¶ç›®å½•

### 5ï¸âƒ£ è®¿é—® Twitter/X å¹¶å¼€å§‹æ”¶é›†æ•°æ®

è®¿é—® https://x.comï¼Œæ’ä»¶ä¼šè‡ªåŠ¨åˆ†ææ¨æ–‡å¹¶ä¿å­˜æ•°æ®ã€‚

## ğŸ“Š æ•°æ®æ ¼å¼

ä¿å­˜çš„ JSONL æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒæ ·æœ¬ï¼š

```json
{
  "timestamp": "2025-01-12T10:30:45.123456",
  "instruction": "åˆ†æè¿™æ¡æ¨æ–‡çš„ä¿®è¾æ‰‹æ³•å’Œæƒ…ç»ªæ“çºµç¨‹åº¦...",
  "input": "æ¨æ–‡åŸå§‹å†…å®¹",
  "output": "{\"rhetoric_score\": 6, \"manipulation_score\": 7, \"label\": \"æƒ…ç»ªå¼•å¯¼\", \"reason\": \"...\"}",
  "meta": {
    "url": "https://x.com/user/status/123456",
    "model": "xiuci-win-pro:latest",
    "cached": false,
    "record_id": "1736668245123-abc123"
  }
}
```

è¿™ç§æ ¼å¼é€‚åˆï¼š
- âœ… LLaMA / Alpaca ç³»åˆ—æ¨¡å‹å¾®è°ƒ
- âœ… Qwen æ¨¡å‹å¾®è°ƒ
- âœ… ChatGLM æ¨¡å‹å¾®è°ƒ
- âœ… è‡ªå®šä¹‰è®­ç»ƒæµç¨‹

## ğŸ” æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

### æ–¹æ³• 1ï¼šé€šè¿‡æµè§ˆå™¨

è®¿é—® http://127.0.0.1:8888/statsï¼Œä¼šè¿”å›ï¼š

```json
{
  "total_records": 234,
  "file_size": 145678,
  "file_path": "D:\\code\\rhetoric-detector-extension\\twitter_training_data.jsonl"
}
```

### æ–¹æ³• 2ï¼šé€šè¿‡æ’ä»¶ Popup

ç‚¹å‡»æ’ä»¶å›¾æ ‡ï¼ŒæŸ¥çœ‹ã€Œè®­ç»ƒæ•°æ®æ¡æ•°ã€ç»Ÿè®¡ã€‚

### æ–¹æ³• 3ï¼šå‘½ä»¤è¡ŒæŸ¥çœ‹

Windows PowerShell:
```powershell
(Get-Content twitter_training_data.jsonl).Count
```

Linux/Mac:
```bash
wc -l twitter_training_data.jsonl
```

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. æ•°æ®ä¿å­˜æ˜¯è‡ªåŠ¨çš„
- âœ… æ’ä»¶å·¥ä½œæ—¶è‡ªåŠ¨ä¿å­˜ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- âœ… åªä¿å­˜éç¼“å­˜çš„æ–°åˆ†æç»“æœ
- âœ… ä¸ä¿å­˜é”™è¯¯çš„åˆ†æç»“æœ
- âœ… é™é»˜å¤±è´¥ï¼Œä¸å½±å“æ’ä»¶ä¸»åŠŸèƒ½

### 2. æ•°æ®è´¨é‡æ§åˆ¶

å¦‚æœå‘ç°æ•°æ®è´¨é‡ä¸å¥½ï¼Œå¯ä»¥ï¼š
- è°ƒæ•´ Ollama æ¨¡å‹çš„ prompt
- ä¿®æ”¹æ¨¡å‹å‚æ•°ï¼ˆtemperature, top_p ç­‰ï¼‰
- æ›´æ¢æ›´é€‚åˆçš„æ¨¡å‹

### 3. æ•°æ®å¤‡ä»½

å®šæœŸå¤‡ä»½ `twitter_training_data.jsonl`ï¼š

```bash
# Windows
copy twitter_training_data.jsonl backup_20250112.jsonl

# Linux/Mac
cp twitter_training_data.jsonl backup_20250112.jsonl
```

### 4. æ•°æ®é¢„å¤„ç†

è®­ç»ƒå‰å»ºè®®ï¼š
- å»é‡ï¼ˆæ ¹æ® input å­—æ®µï¼‰
- è¿‡æ»¤é”™è¯¯è®°å½•
- å¹³è¡¡ä¸åŒç±»åˆ«çš„æ ·æœ¬

ç¤ºä¾‹ Python è„šæœ¬ï¼š

```python
import json
from collections import defaultdict

# è¯»å–å¹¶å»é‡
seen = set()
records = []
with open('twitter_training_data.jsonl', 'r', encoding='utf-8') as f:
    for line in f:
        record = json.loads(line)
        if record['input'] not in seen:
            seen.add(record['input'])
            records.append(record)

print(f"åŸå§‹è®°å½•: {len(seen) + len(records)}")
print(f"å»é‡å: {len(records)}")

# ä¿å­˜æ¸…æ´—åçš„æ•°æ®
with open('cleaned_data.jsonl', 'w', encoding='utf-8') as f:
    for record in records:
        f.write(json.dumps(record, ensure_ascii=False) + '\n')
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ’ä»¶æ˜¾ç¤ºã€Œè®­ç»ƒæ•°æ®æ¡æ•°: ç¦»çº¿ã€

**åŸå› ï¼š** Python æœåŠ¡å™¨æœªå¯åŠ¨

**è§£å†³ï¼š**
```bash
python save_server.py
```

### é—®é¢˜ï¼šæ•°æ®æ–‡ä»¶ä¸ºç©º

**å¯èƒ½åŸå› ï¼š**
1. Python æœåŠ¡å™¨æœªå¯åŠ¨
2. æ’ä»¶æœªè¿æ¥åˆ°æœåŠ¡å™¨
3. Ollama åˆ†æå¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. ç¡®è®¤ Python æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è¿æ¥é”™è¯¯
3. ç¡®è®¤ Ollama æ­£å¸¸å·¥ä½œ

### é—®é¢˜ï¼šCORS é”™è¯¯

**è§£å†³ï¼š** å·²åœ¨ `save_server.py` ä¸­é…ç½® CORSï¼Œå…è®¸æ‰€æœ‰æ¥æºè®¿é—®ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ Chrome æ‰©å±•æƒé™ã€‚

## ğŸ“ˆ åç»­è®­ç»ƒå»ºè®®

1. **æ”¶é›†æ•°æ®é‡**ï¼šå»ºè®®è‡³å°‘æ”¶é›† 500+ æ¡é«˜è´¨é‡æ•°æ®
2. **æ•°æ®å¹³è¡¡**ï¼šç¡®ä¿ä¸åŒé£é™©ç­‰çº§çš„æ ·æœ¬æ¯”ä¾‹åˆç†
3. **è®­ç»ƒæ¡†æ¶**ï¼šæ¨èä½¿ç”¨ LLaMA-Factoryã€FastChat ç­‰å·¥å…·
4. **è¯„ä¼°æŒ‡æ ‡**ï¼šå‡†ç¡®ç‡ã€F1-scoreã€æ··æ·†çŸ©é˜µ

## ğŸ”— ç›¸å…³é“¾æ¥

- Ollama: https://ollama.ai/
- FastAPI: https://fastapi.tiangolo.com/
- LLaMA-Factory: https://github.com/hiyouga/LLaMA-Factory

## ğŸ“ æ•°æ®æ ¼å¼è¯´æ˜

### Instructionï¼ˆæŒ‡ä»¤ï¼‰
å›ºå®šçš„åˆ†æä»»åŠ¡æè¿°ï¼Œå‘Šè¯‰æ¨¡å‹éœ€è¦åšä»€ä¹ˆã€‚

### Inputï¼ˆè¾“å…¥ï¼‰
æ¨æ–‡çš„åŸå§‹æ–‡æœ¬å†…å®¹ã€‚

### Outputï¼ˆè¾“å‡ºï¼‰
æ¨¡å‹è¿”å›çš„ JSON æ ¼å¼åˆ†æç»“æœï¼ŒåŒ…å«ï¼š
- `rhetoric_score`: ä¿®è¾å¯†åº¦ (0-10)
- `manipulation_score`: æ“çºµæŒ‡æ•° (0-10)
- `label`: åˆ†ç±»æ ‡ç­¾ï¼ˆå¦‚"ç†æ€§è®¨è®º"ã€"æƒ…ç»ªå¼•å¯¼"ã€"æ”¿æ²»å®£ä¼ "ï¼‰
- `reason`: è¯¦ç»†çš„åˆ†æç†ç”±

### Metaï¼ˆå…ƒæ•°æ®ï¼‰
- `url`: æ¨æ–‡é“¾æ¥
- `model`: ä½¿ç”¨çš„æ¨¡å‹åç§°
- `cached`: æ˜¯å¦æ¥è‡ªç¼“å­˜
- `record_id`: å”¯ä¸€è®°å½• ID

---

**å¼€å§‹æ”¶é›†æ•°æ®ï¼Œè®­ç»ƒä½ è‡ªå·±çš„ä¿®è¾åˆ†ææ¨¡å‹ï¼** ğŸš€
